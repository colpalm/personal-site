{{ $chartID := default (printf "chart-%d" (now.UnixNano)) (.Get "id") }}
{{ $chartType := default "bar" (.Get "type") }}
{{ $height := default "400" (.Get "height") }}
{{ $width := default "100%" (.Get "width") }}
{{ $useDefaultColors := default "true" (.Get "useDefaultColors") | lower }}
{{ $data := .Inner }}

<div class="chart-container" style="height: {{ $height }}px; width: {{ $width }};">
    <canvas id="{{ $chartID }}"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('{{ $chartID }}').getContext('2d');
        const chartData = {{ $data | safeJS }};

        // Apply theme colors to datasets
        if ("{{ $useDefaultColors }}" === "true" && chartData.data && chartData.data.datasets) {
            window.ThemeHelper.applyChartDatasetColors(chartData.data.datasets, "{{ $chartType }}", true);
        }

        // Apply theme colors to chart options
        if (chartData.options) {
            window.ThemeHelper.applyChartOptionsColors(chartData.options);
        }

        // Create the chart with maintainAspectRatio: false to prevent extending beyond container
        new Chart(ctx, {
            type: '{{ $chartType }}',
            data: chartData.data,
            options: Object.assign({
                maintainAspectRatio: false,
                responsive: true
            }, chartData.options || {})
        });
    });
</script>